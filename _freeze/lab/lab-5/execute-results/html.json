{
  "hash": "b587d574e2e9b6655c24a1ea7dfeac07",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Lab 5\nsubtitle: Visualize, model, interpret\ncategories: Lab\ndescription: \"Mon, Nov 4 at 8:30 am\"\ndraft: false\n---\n\n\n\n\n# Introduction\n\nIn this lab you'll start your practice of statistical modeling.\nYou'll fit models, interpret model output, and make decisions about your data and research question based on the model results.\nAnd you'll wrap up the lab revisiting the topic of data science ethics.\n\n::: callout-note\nThis lab assumes you've completed the labs so far and doesn't repeat setup and overview content from those labs.\nIf you haven't done those yet, you should review the previous labs before starting on this one.\n:::\n\n## Learning objectives\n\nBy the end of the lab, you will...\n\n-   Fit linear regression models and interpret model coefficients in context of the data and research question.\n-   Transform data using a log-transformation for a better model fit.\n-   Evaluate the validity of a data visualization and correct any misleading mistakes.\n\nAnd, as usual, you will also...\n\n-   Get more experience with data science workflow using R, RStudio, Git, and GitHub\n-   Further your reproducible authoring skills with Quarto\n-   Improve your familiarity with version control using Git and GitHub\n\n## Getting started\n\nLog in to RStudio, clone your `lab-5` repo from GitHub, open your `lab-5.qmd` document, and get started!\n\n::: {.callout-tip collapse=\"true\"}\n## Click here if you prefer to see step-by-step instructions\n\n### Step 1: Log in to RStudio\n\n-   Go to <https://cmgr.oit.duke.edu/containers> and log in with your Duke NetID and Password.\n-   Click `STA198-199` under My reservations to log into your container. You should now see the RStudio environment.\n\n### Step 2: Clone the repo & start a new RStudio project\n\n-   Go to the course organization at [github.com/sta199-f24](https://github.com/sta199-f24) organization on GitHub.\n    Click on the repo with the prefix **lab-5**.\n    It contains the starter documents you need to complete the lab.\n\n-   Click on the green **CODE** button and select **Use SSH**. This might already be selected by default; if it is, you'll see the text **Clone with SSH**.\n    Click on the clipboard icon to copy the repo URL.\n\n-   In RStudio, go to *File* ➛ *New Project* ➛*Version Control* ➛ *Git*.\n\n-   Copy and paste the URL of your assignment repo into the dialog box *Repository URL*. Again, please make sure to have *SSH* highlighted under *Clone* when you copy the address.\n\n-   Click *Create Project*, and the files from your GitHub repo will be displayed in the *Files* pane in RStudio.\n\n-   Click *lab-5.qmd* to open the template Quarto file.\n    This is where you will write up your code and narrative for the lab.\n\n### Step 3: Update the YAML\n\nIn `lab-5.qmd`, update the `author` field to your name, render your document and examine the changes.\nThen, in the Git pane, click on **Diff** to view your changes, add a commit message (e.g., \"Added author name\"), and click **Commit**.\nThen, push the changes to your GitHub repository, and in your browser confirm that these changes have indeed propagated to your repository.\n:::\n\n::: callout-important\nIf you run into any issues with the first steps outlined above, flag a TA for help before proceeding.\n:::\n\n## Packages\n\nIn this lab, we will work with the\n\n-   **tidyverse** package for doing data analysis in a \"tidy\" way,\n-   **tidymodels** package for modeling in a \"tidy\" way, and\n-   **openintro** package for the dataset for Part 1.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(openintro)\n```\n:::\n\n\n\n\n-   **Run** the code cell by clicking on the green triangle (play) button for the code cell labeled `load-packages`. This loads the package so that its features (the functions and datasets in it) are accessible from your *Console*.\n-   Then, **render** the document that loads this package to make its features (the functions and datasets in it) available for other code cells in your Quarto document.\n\n## Guidelines\n\n\nAs we've discussed in lecture, your plots should include an informative title, axes and legends should have human-readable labels, and careful consideration should be given to aesthetic choices.\n\nAdditionally, code should follow the [tidyverse style](https://style.tidyverse.org/).\nParticularly,\n\n-   there should be spaces before and line breaks after each `+` when building a `ggplot`,\n\n-   there should also be spaces before and line breaks after each `|>` in a data transformation pipeline,\n\n-   code should be properly indented,\n\n-   there should be spaces around `=` signs and spaces after commas.\n\nFurthermore, all code should be visible in the PDF output, i.e., should not run off the page on the PDF.\nLong lines that run off the page should be split across multiple lines with line breaks.\n\n::: callout-important\nContinuing to develop a sound workflow for reproducible data analysis is important as you complete the lab and other assignments in this course.\nThere will be periodic reminders in this assignment to remind you to **render, commit, and push** your changes to GitHub.\nYou should have at least 3 commits with meaningful commit messages by the end of the assignment.\n:::\n\n\n\n::: callout-important\nYou are also expected to pay attention to [code smell](https://en.wikipedia.org/wiki/Code_smell) in addition to code style and readability.\nYou should review and improve your code to avoid redundant steps (e.g., grouping, ungrouping, and grouping again by the same variable in a pipeline), using inconsistent syntax (e.g., `!` to say \"not\" in one place and `-` in another place), etc.\n:::\n\n# Part 1 - Smoking during pregnancy\n\n## Question 1\n\nWe are interested in the impact of smoking during pregnancy.\nSince it is not possible to run a randomized controlled experiment to investigate this impact, we will instead use a data set has been of interest to medical researchers who are studying the relation between habits and practices of expectant mothers and the birth of their children.\nThis is a random sample of 1,000 cases from a data set released in 2014 by the state of North Carolina.\nThe data set is called `births14`, and it is included in the **openintro** package you loaded at the beginning of the assignment.\n\na.  Create a version of the `births14` data set dropping observations where there are `NA`s for `habit`.\n    You can call this version `births14_habitgiven`.\n\nb.  Plotting the data is a useful first step because it helps us quickly visualize trends, identify strong associations, and develop research questions.\n    Create an appropriate plot displaying the relationship between `weight` and `habit`.\n    In 2-3 sentences, discuss the relationship observed.\n\n## Question 2\n\na.  Fit a linear model that predicts `weight` from `habit` and save the model object.\n    Then, provide the tidy summary output.\n\nb.  Write the estimated least squares regression line below using proper notation.\n\n::: callout-tip\nIf you need to type an equation using proper notation, type your answers in-between `$$` and `$$`.\nYou may use `\\hat{example}` to put a hat on a character.\n:::\n\nc.  Interpret the intercept in the context of the data and the research question.\n    Is the intercept meaningful in this context?\n    Why or why not?\n\nd.  Interpret the slope in the context of the data and the research question.\n\n## Question 3\n\na.  Another researcher is interested in assessing the relationship between babies’ weights and mothers’ ages.\n    Fit another linear model predicting `weight` to investigate this relationship and save the model object.\n    Then, provide the tidy summary output.\n\nb.  In 2-3 sentences, explain how the regression line to model these data is fit, i.e., based on what criteria R determines the regression line.\n\nc.  Interpret the intercept in the context of the data and the research question.\n    Is the intercept meaningful in this context?\n    Why or why not?\n\nd.  Interpret the slope in the context of the data and the research question.\n\n# Part 2 - Parasites\n\nParasites can cause infectious disease – but not all animals are affected by the same parasites.\nSome parasites are present in a multitude of species and others are confined to a single host.\nIt is hypothesized that closely related hosts are more likely to share the same parasites.\nMore specifically, it is thought that closely related hosts will live in similar environments and have similar genetic makeup that coincides with optimal conditions for the same parasite to flourish.\n\nIn this part of the lab, we will see how much evolutionary history predicts parasite similarity.\n\nThe dataset comes from an Ecology Letters paper by Cooper at al. (2012) entitled “Phylogenetic host specificity and understanding parasite sharing in primates” located [here](https://onlinelibrary.wiley.com/doi/10.1111/j.1461-0248.2012.01858.x).\nThe goal of the paper was to identify the ability of evolutionary history and ecological traits to characterize parasite host specificity.\n\nEach row of the data contains two species, `species1` and `species2`.\n\nSubsequent columns describe metrics that compare the species:\n\n-   `divergence_time`: how many (millions) of years ago the two species diverged.\n    i.e. how many million years ago they were the same species.\n\n-   `distance`: geodesic distance between species geographic range centroids (in kilometers)\n\n-   `BMdiff`: difference in body mass between the two species (in grams)\n\n-   `precdiff`: difference in mean annual precipitation across the two species geographic ranges (mm)\n\n-   `parsim`: a measure of parasite similarity (proportion of parasites shared between species, ranges from 0 to 1.)\n\nThe data are available in `parasites.csv` in your `data` folder.\n\n## Question 4\n\nLet’s start by reading in the `parasites` data and examining the relationship between `divergence_time` and `parsim`.\n\na.  Load the data and save the data frame as `parasites`.\n\nb.  Based on the goals of the analysis, what is the response variable?\n\nc.  Visualize the relationship between the two variables.\n\nd.  Use the visualization to describe the relationship between the two variables.\n\n## Question 5\n\nNext, model this relationship.\n\na.  Fit the model and write the estimated regression equation.\n\nb.  Interpret the slope and the intercept in the context of the data.\n\nc.  Recreate the visualization from Question 4, this time adding a regression line to the visualization.\n\nd.  What do you notice about the prediction (regression) line that may be strange, particularly for very large divergence times?\n\n## Question 6\n\nSince `parsim` takes values between 0 and 1, we want to transform this variable so that it can range between (−∞,+∞).\nThis will be better suited for fitting a regression model (and interpreting predicted values!)\n\na.  Using mutate, create a new variable `transformed_parsim` that is calculated as `log(parsim/(1-parsim))`.\n    Add this variable to your data frame.\n\n    ::: callout-note\n    `log()` in R represents the **nautral log**.\n    :::\n\nb.  Then, visualize the relationship between divergence_time and `transformed_parsim`.\n    Add a regression line to your visualization.\n\nc.  Write a 1-2 sentence description of what you observe in the visualization.\n\n## Question 7\n\n*Which variable is the strongest individual predictor of parasite similarity between species?*\n\nTo answer this question, begin by fitting a linear regression model to each pair of variables.\nDo not report the model outputs in a tidy format but save each one as `dt_model`, `dist_model`, `BM_model`, and `prec_model`, respectively.\n\n-   `divergence_time` and `transformed_parsim`\n\n-   `distance` and `transformed_parsim`\n\n-   `BMdiff` and `transformed_parsim`\n\n-   `precdiff` and `transformed_parsim`\n\na.  Report the slopes for each of these models.\n    Use proper notation.\n\nb.  To answer the question of interest, would it be useful to compare the slopes in each model to choose the variable that is the strongest predictor of parasite similarity?\n    Why or why not?\n\n## Question 8\n\nNow, what if we calculated $R^2$ to help answer our question?\nTo compare the explanatory power of each individual predictor, we will look at $R^2$ between the models.\n$R^2$ is a measure of how much of the variability in the response variable is explained by the model.\n\nAs you may have guessed from the name $R^2$ can be calculated by squaring the correlation when we have a simple linear regression model.\nThe correlation r takes values -1 to 1, therefore, $R^2$ takes values 0 to 1.\nIntuitively, if r=1 or −1, then $R^2$=1, indicating the model is a perfect fit for the data.\nIf r≈0 then $R^2$≈0, indicating the model is a very bad fit for the data.\n\nYou can calculate $R^2$ using the glance function.\nFor example, you can calculate $R^2$ for `dt_model` using the code `glance(dt_model)$r.squared`.\n\na.  Calculate and report $R^2$ for each model fit in the previous exercise.\n\nb.  To answer our question of interest, would it be useful to compare the $R^2$ in each model to choose the variable that is the strongest predictor of parasite similarity?\n    Why or why not?\n\n# Part 3 - Misrepresentation\n\n## Question 9\n\nThe following chart was [shared](https://twitter.com/GraphCrimes/status/1566264004288331776) by \\@GraphCrimes on X/Twitter on September 3, 2022.\n\n![](images/lab-5/private-sector.png){fig-align=\"center\"}\n\na.  What is misleading about this graph?\nb.  Suppose you wanted to recreate this plot, with improvements to avoid its misleading pitfalls from part (a). You would obviously need the data from the survey in order to be able to do that. How many observations would this data have? How many variables (at least) should it have, and what should those variables be?\nc.  Load the data for this survey from `data/survation.csv`. Confirm that the data match the percentages from the visualization. That is, calculate the percentages of public sector, private sector, don't know for each of the services and check that they match the percentages from the plot.\n\n## Question 10\n\nCreate an improved version of the visualization.\nYour improved visualization:\n\n-   should also be a stacked bar chart with services on the y-axis and presented in the same order as the original plot; sectors should create segments of the plot using the same colors (colors do not have to be exact) and appear in the same order as the original plot\n\n-   should have the same legend location\n\n-   should have the same title and caption\n\n-   does not need to have a bolded title or a gray background\n\nHow does the improved visualization look different than the original?\nDoes it send a different message at a first glance?\n\n::: callout-tip\nUse `\\n` to add a line break to your title.\nAnd note that since the title is very long, it might run off the page in your code.\nThat's ok!\n\nAdditionally, the colors used in the plot are `gray`, `#FF3205`, and `#006697`.\n:::\n\n::: render-commit-push\nRender, commit, and push one last time.\nMake sure that you commit and push all changed documents and your Git pane is completely empty before proceeding.\n\n<br>\n:::\n\n# Part 4 - Coded Bias\n\nWatch the documentary \"Coded Bias\".\nTo do so, you either need to be on the Duke network or connected to the Duke VPN. Then go to <https://find.library.duke.edu/catalog/DUKE009834953> and click on \"View Online\".\nThere is nothing to turn in for this part.\nOnce you watch the video, reflect on points highlighting at least one thing that you already knew about (from the course prep materials) and at least one thing you learned from the movie as well as any other aspects of the documentary that you found interesting / enlightening.\nThere is nothing to turn in for this part.\n",
    "supporting": [
      "lab-5_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}