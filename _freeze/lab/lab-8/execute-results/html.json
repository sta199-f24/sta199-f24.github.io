{
  "hash": "9dae562d852f0031db166766edc1f2bb",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Lab 8\nsubtitle: Everything so far II\ncategories: Lab\ndescription: \"Tue, Nov 26 at 10:30 pm\"\n---\n\n\n\n\n\n# Project next steps\n\nBefore diving into the lab, let's first check in on your project's next steps.\n\n-   **Before Monday, Nov 25 - Between Milestones 3 and 4:**\n    -   Read the instructions for [Milestone 4](/project/4-peer-review) and [Milestone 5](/project/5-writeup-presenation).\n    -   Bare minimum: Make substantial progress on your project write-up: Finish your introduction and exploratory data analysis (plots/summary statistics + their interpretations) + Write up methods you plan to use.\n    -   Ideal: Start implementing the methods and get closer to answering your research question.\n-   **On Monday, Nov 25 - Milestone 4:**\n    -   Peer review of others' projects in the lab.\n    -   You must be in the lab to participate in the peer review.\n    -   If you cannot be there physically due to Thanksgiving travel, make arrangements to Zoom in with the rest of your team who are in lab.\n-   **After Monday, Nov 26:** Work on write-up and presentation incorporating feedback from peers and meeting with TAs/instructor as needed during office hours for further feedback.\n\n# Introduction\n\nIn this lab, you'll continue building and evaluating predictive models and performing statistical inferences.\n\nAdditionally, you'll revisit two questions of your choice from previous assignments/assessments.\n\n## Learning objectives\n\nBy the end of the lab, you will...\n\n-   Train models on training data and test them on testing data to evaluate and compare their performances.\n-   Perform statistical inference with bootstrapping and hypothesis testing.\n-   Revisit two questions from previous assignments/assessments.\n\nAnd, as usual, you will also...\n\n-   Get more experience with data science workflow using R, RStudio, Git, and GitHub\n-   Further your reproducible authoring skills with Quarto\n-   Improve your familiarity with version control using Git and GitHub\n\n::: callout-note\nThis lab is due on **Tue, November 26 at 10:30 pm**, i.e., right before Thanksgiving break begins.\n:::\n\n## Getting started\n\nLog in to RStudio, clone your `lab-8` repo from GitHub, open your `lab-8.qmd` document, and get started!\n\n## Packages\n\nIn this lab, we will work with the\n\n-   **tidyverse** package for doing data analysis in a \"tidy\" way and\n-   **tidymodels** package for modeling in a \"tidy\" way.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\n```\n:::\n\n\n\n\n\n-   **Run** the code cell by clicking on the green triangle (play) button for the code cell labeled `load-packages`. This loads the package so that its features (the functions and datasets in it) are accessible from your *Console*.\n-   Then, **render** the document that loads this package to make its features (the functions and datasets in it) available for other code cells in your Quarto document.\n\n## Guidelines\n\n\nAs we've discussed in lecture, your plots should include an informative title, axes and legends should have human-readable labels, and careful consideration should be given to aesthetic choices.\n\nAdditionally, code should follow the [tidyverse style](https://style.tidyverse.org/).\nParticularly,\n\n-   there should be spaces before and line breaks after each `+` when building a `ggplot`,\n\n-   there should also be spaces before and line breaks after each `|>` in a data transformation pipeline,\n\n-   code should be properly indented,\n\n-   there should be spaces around `=` signs and spaces after commas.\n\nFurthermore, all code should be visible in the PDF output, i.e., should not run off the page on the PDF.\nLong lines that run off the page should be split across multiple lines with line breaks.\n\n::: callout-important\nContinuing to develop a sound workflow for reproducible data analysis is important as you complete the lab and other assignments in this course.\nThere will be periodic reminders in this assignment to remind you to **render, commit, and push** your changes to GitHub.\nYou should have at least 3 commits with meaningful commit messages by the end of the assignment.\n:::\n\n\n\n::: callout-important\nYou are also expected to pay attention to [code smell](https://en.wikipedia.org/wiki/Code_smell) in addition to code style and readability.\nYou should review and improve your code to avoid redundant steps (e.g., grouping, ungrouping, and grouping again by the same variable in a pipeline), using inconsistent syntax (e.g., `!` to say \"not\" in one place and `-` in another place), etc.\n:::\n\n# Part 1: Hotel cancellations (again)\n\nFor this exercise, we will work with hotel cancellations data from the previous lab.\n\nThe dataset, called `hotels.csv`, can be found in the `data` folder.\nRecall that the data describes the demand for two different types of hotels.\nEach observation represents a hotel booking between July 1, 2015, and August 31, 2017.\nSome bookings were canceled (`is_canceled = 1`), and others were kept, i.e., the guests checked into the hotel (`is_canceled = 0`).\nYou can learn more about the data at <https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-02-11> and a data dictionary has been included in the README of the `data` folder of your repository.\n\n## Question 1\n\na.  Read the data in with `read_csv()`.\n\nb.  Transform the `is_canceled` variable to be a factor with \"not canceled\" (0) as the first level and \"canceled\" (1) as the second level.\n    Confirm that you were able to successfully transform the variable by running `levels(hotel$is_canceled)`.\n\nc.  Split the data into training (75%) and testing (25%) sets.\n    Report the number of rows in the testing and training sets.\n\nd.  Fit a model to the training data predicting whether a reservation is canceled from `hotel` type (Resort or City Hotel) and at least two other predictors.\n    Provide a tidy output of the model fit.\n\ne.  Make predictions for the testing data.\n    Then, in a single pipeline, calculate the false positive and negative rates.\n    Make sure that your answer makes it clear which rates are which.\n\n## Question 2\n\na.  Fit another model to the training data predicting whether a reservation is canceled from the variables you used in Question 1 plus one other predictor.\n    State the new predictor and why you chose it.\n\nb.  Make predictions for the testing data.\n    Then, in a single pipeline, calculate the false positive and negative rates.\n    Make sure that your answer makes it clear which rates are which.\n\n## Question 3\n\na.  What was the name you used for the model fit object for the model you created in Question 1?\n    What about in Question 2?\n\nb.  Plot the ROC curves of the models from Question 1 and Question 2 on the same plot, using different colors for each model and a legend that describes which model is represented with which color.\n\n    ::: callout-tip\n    Since the level of `is_canceled` we're predicting is the second level, we need to set `event_level = \"second\"` when calculating the ROC curve.\n    :::\n\nc.  Calculate the AUC (area under the curve) for each model using the `roc_auc()` function.\n\n::: callout-hint\nYou can review its documentation to figure out how this function works.\n:::\n\nd.  Based on your findings so far, articulate which of the two models is preferable for predicting hotel cancellations and why.\n\n# Part 2: Lemurs\n\nIn this part, you'll work with data from the [Duke Lemur Center](https://lemur.duke.edu/), which houses over 200 lemurs across 14 species -- the most diverse population of lemurs on Earth, outside their native Madagascar.\n\n> Lemurs are the most threatened group of mammals on the planet, and 95% of lemur species are at risk of extinction.\n> Our mission is to learn everything we can about lemurs -- because the more we learn, the better we can work to save them from extinction.\n> They are endemic only to Madagascar, so it's essentially a one-shot deal: once lemurs are gone from Madagascar, they are gone from the wild.\n\n> By studying the variables that most affect their health, reproduction, and social dynamics, the Duke Lemur Center learns how to most effectively focus [their conservation efforts](https://lemur.duke.edu/protect/overview-madagascar-conservation-programs/).\n> And the more we learn about lemurs, the better we can educate the public around the world about just how amazing these animals are, why they need to be protected, and how each and every one of us can make a difference in their survival.\n\n> Source: [TidyTuesday](https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-08-24/readme.md)\n\nWhile the TidyTuesday project used the full dataset, you'll work with a subset.\nThe dataset, called `lemurs.csv`, can be found in the `data` folder.\nYou can learn more about the data at <https://github.com/rfordatascience/tidytuesday/blob/master/data/2021/2021-08-24>.\nA data dictionary has been included in the README of the `data` folder of your repository.\n\n## Question 4\n\nLoad the `lemurs` data from your `data` folder and save it as `lemurs`.\nThen, report which \"types\" of lemurs are represented in the sample and how many of each.\nNote that this information is in the `taxon` variable.\nYou should refer back to the linked data dictionary to understand what the different values of `taxon` mean.\nYour response should be a tibble with at least three columns, `taxon`, `taxon_name` (a new variable you create that contains the description of the `taxon`, e.g., `EMON` is `Mongoose lemur`), and `n` (number of lemurs with that taxon).\n\n## Question 5\n\nWhat is the slope of the regression line for predicting weights of lemurs (`weight_g`) from the ages of lemurs (in years) when their weight was measured (`age_at_wt_y`)?\nCalculate and interpret a 95% bootstrap bootstrap confidence interval.\nAlso report your point estimate.\nDon't forget to set a seed and use 1,000 bootstrap samples (`reps = 1000`) when simulating your bootstrap distribution.\n\n::: callout-tip\nBelow is a step-by-step recipe for constructing and visualizing a confidence interval.\nThe code snippets shown are not \"complete.\" They include some blanks you need to fill in, and they are just intended to guide you in the right direction.\n\n-   Step 1: Calculate the point estimate for the slope and the intercept of the regression line.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nobs_fit <- lemurs |>\n  specify(weight_g ~ age_at_wt_y) |>\n  fit()\n```\n:::\n\n\n\n\n\n-   Step 2: Simulate a bootstrap distribution.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(___)\n\nboot_dist <- lemurs |>\n  specify(weight_g ~ age_at_wt_y) |>\n  generate(reps = ____, type = \"bootstrap\") |>\n  fit()\n```\n:::\n\n\n\n\n\n-   Step 3: Calculate the bounds of the confidence interval.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nconf_ints <- \n  get_confidence_interval(\n    boot_dist, \n    level = ___, \n    point_estimate = obs_fit\n  )\n```\n:::\n\n\n\n\n:::\n\n## Question 6\n\nWhat are the slopes of the regression line for predicting weights of lemurs (`weight_g`) from the ages of lemurs (in years) when their weight was measured (`age_at_wt_y`) and their types (`taxon`)?\nCalculate and interpret a 95% bootstrap bootstrap confidence interval.\nAlso report your point estimate.\nDon't forget to set a seed and use 1,000 bootstrap samples (`reps = 1000`) when simulating your bootstrap distribution.\n\n## Question 7\n\nWhat is the **median** weight of red-bellied lemurs?\nWhat is the **median** weight of ring-tailed lemurs?\nWhat is the **median** weight of mongoose lemurs?\nCalculate and interpret a 95% bootstrap bootstrap confidence intervals.\nAlso report your point estimates.\nDon't forget to set a seed and use 1,000 bootstrap samples (`reps = 1000`) when simulating your bootstrap distribution.\n\n## Question 8\n\nDo female lemurs differ in weight from male lemurs, on average?\n\na.  Conduct a hypothesis test to answer this question at 5% significance level.\n    Clearly state your hypotheses in the context of the data and the research question, simulate a randomization distribution, find the p-value, and make a decision on your hypotheses based on this p-value.\n    Provide a one-sentence conclusion for your hypothesis test in the context of the data and the research question.\n    Don't forget to set a seed and use 1,000 randomization samples (`reps = 1000`) when simulating your randomization distribution.\n\nb.  Based on your answer to Part (a), would you expect a 95% confidence interval for the difference in means of female and male lemurs to include 0?\n    Explain your reasoning.\n\nc.  Construct and interpret a 95% bootstrap confidence interval for the difference in means of female and male lemurs.\n    Does it include 0?\n    Does this align with your answer to Part (b)?\n    Don't forget to set a seed and use 1,000 bootstrap samples (`reps = 1000`) when simulating your bootstrap distribution.\n\n# Part 3: Second chances\n\nIn this part, you get to revisit work you've turned in before that can be improved.\nFor Question 9 you'll pick a question from a previous lab and for Question 10 a question from your take-home midterm, and improve them.\n\nSome of these improvements might be \"fixes\" for things that were pointed out as missing or incorrect.\nSome of them might be things you hoped to do before the deadline but didn't get a chance to.\nSome notes for completing this exercise:\n\n-   You might need to add your data from your lab/midterm to the `data/` folder in this assignment.\n    You do not need to also add a data dictionary.\n\n-   You will need to copy over any code needed to clean/prepare your data for this specific question.\n    You can reuse code from your previous assignment, but note that we will re-evaluate your code as part of the grading for this exercise.\n    This means we might catch something wrong with it that we didn't catch before, so if you spot any errors, make sure to fix them.\n\n-   Don't worry about being critical of your own work.\n    Even if you lost no points on the question if you think it can be improved, articulate how / why.\n    We will not apply additional penalties for any mistakes you might point out that we didn't catch when grading your lab/midterm.\n    There's no risk of being critical!\n\n## Question 9\n\nChoose one question from a previous lab that you received lots of feedback on and/or lost many points on and improve it.\nFirst, write one sentence reminding us of the specific question and a few sentences on why you chose this specific question to improve and how you plan to improve it.\nThen, improve it.\n\n## Question 10\n\nChoose one question from the take-home midterm that you received lots of feedback on and/or lost many points on and improve it.\nFirst, write one sentence reminding us of the specific question and a few sentences on why you chose this specific question to improve and how you plan to improve it.\nThen, improve it.\n",
    "supporting": [
      "lab-8_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}