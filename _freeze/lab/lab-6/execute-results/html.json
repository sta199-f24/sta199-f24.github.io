{
  "hash": "95e4cef004742a3bff965f952c088317",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Lab 6\nsubtitle: Visualize, model, interpret again\ncategories: Lab\ndescription: \"Mon, Nov 11 at 8:30 am\"\n---\n\n\n\n\n# Introduction\n\nIn this lab you'll start your practice of statistical modeling.\nYou'll fit models, interpret model output, and make decisions about your data and research question based on the model results.\nAnd you'll wrap up the lab revisiting the topic of data science ethics.\n\n::: callout-note\nThis lab assumes you've completed the labs so far and doesn't repeat setup and overview content from those labs.\nIf you haven't done those yet, you should review the previous labs before starting on this one.\n:::\n\n## Learning objectives\n\nBy the end of the lab, you will...\n\n-   Fit, interpret, and make predictions with models with multiple predictors.\n-   Perform model selection.\n\nAnd, as usual, you will also...\n\n-   Get more experience with data science workflow using R, RStudio, Git, and GitHub\n-   Further your reproducible authoring skills with Quarto\n-   Improve your familiarity with version control using Git and GitHub\n\n## Getting started\n\nLog in to RStudio, clone your `lab-6` repo from GitHub, open your `lab-6.qmd` document, and get started!\n\n::: {.callout-tip collapse=\"true\"}\n## Click here if you prefer to see step-by-step instructions\n\n### Step 1: Log in to RStudio\n\n-   Go to <https://cmgr.oit.duke.edu/containers> and log in with your Duke NetID and Password.\n-   Click `STA198-199` under My reservations to log into your container. You should now see the RStudio environment.\n\n### Step 2: Clone the repo & start a new RStudio project\n\n-   Go to the course organization at [github.com/sta199-f24](https://github.com/sta199-f24) organization on GitHub.\n    Click on the repo with the prefix **lab-6**.\n    It contains the starter documents you need to complete the lab.\n\n-   Click on the green **CODE** button and select **Use SSH**. This might already be selected by default; if it is, you'll see the text **Clone with SSH**.\n    Click on the clipboard icon to copy the repo URL.\n\n-   In RStudio, go to *File* ➛ *New Project* ➛*Version Control* ➛ *Git*.\n\n-   Copy and paste the URL of your assignment repo into the dialog box *Repository URL*. Again, please make sure to have *SSH* highlighted under *Clone* when you copy the address.\n\n-   Click *Create Project*, and the files from your GitHub repo will be displayed in the *Files* pane in RStudio.\n\n-   Click *lab-6.qmd* to open the template Quarto file.\n    This is where you will write up your code and narrative for the lab.\n\n### Step 3: Update the YAML\n\nIn `lab-6.qmd`, update the `author` field to your name, render your document and examine the changes.\nThen, in the Git pane, click on **Diff** to view your changes, add a commit message (e.g., \"Added author name\"), and click **Commit**.\nThen, push the changes to your GitHub repository, and in your browser confirm that these changes have indeed propagated to your repository.\n:::\n\n::: callout-important\nIf you run into any issues with the first steps outlined above, flag a TA for help before proceeding.\n:::\n\n## Packages\n\nIn this lab, we will work with the\n\n-   **tidyverse** package for doing data analysis in a \"tidy\" way,\n-   **tidymodels** package for modeling in a \"tidy\" way, and\n-   **openintro** package for the dataset for Part 1.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(openintro)\n```\n:::\n\n\n\n\n-   **Run** the code cell by clicking on the green triangle (play) button for the code cell labeled `load-packages`. This loads the package so that its features (the functions and datasets in it) are accessible from your *Console*.\n-   Then, **render** the document that loads this package to make its features (the functions and datasets in it) available for other code cells in your Quarto document.\n\n## Guidelines\n\n\nAs we've discussed in lecture, your plots should include an informative title, axes and legends should have human-readable labels, and careful consideration should be given to aesthetic choices.\n\nAdditionally, code should follow the [tidyverse style](https://style.tidyverse.org/).\nParticularly,\n\n-   there should be spaces before and line breaks after each `+` when building a `ggplot`,\n\n-   there should also be spaces before and line breaks after each `|>` in a data transformation pipeline,\n\n-   code should be properly indented,\n\n-   there should be spaces around `=` signs and spaces after commas.\n\nFurthermore, all code should be visible in the PDF output, i.e., should not run off the page on the PDF.\nLong lines that run off the page should be split across multiple lines with line breaks.\n\n::: callout-important\nContinuing to develop a sound workflow for reproducible data analysis is important as you complete the lab and other assignments in this course.\nThere will be periodic reminders in this assignment to remind you to **render, commit, and push** your changes to GitHub.\nYou should have at least 3 commits with meaningful commit messages by the end of the assignment.\n:::\n\n\n\n::: callout-important\nYou are also expected to pay attention to [code smell](https://en.wikipedia.org/wiki/Code_smell) in addition to code style and readability.\nYou should review and improve your code to avoid redundant steps (e.g., grouping, ungrouping, and grouping again by the same variable in a pipeline), using inconsistent syntax (e.g., `!` to say \"not\" in one place and `-` in another place), etc.\n:::\n\n# Part 1 - Life expectancy and GDP\n\nGapminder is a “fact tank” that uses publicly available world data to produce data visualizations and teaching resources on global development.\nWe will use an excerpt of their data to explore relationships among world health metrics across countries and regions between the years 2000 and 2023.\nThe data set is called `gapminder` and it's in your lab repository's `data` folder.\nA table of variables can be found below.\n\n-   `country`: The country name\n\n-   `continent`: The continent name\n\n-   `year`: Year of data\n\n-   `life_exp`: life expectancy at birth, in years\n\n-   `gdp_percap`: Gross domestic product per peson adjusted for differences in purchasing power (in international dollars, fixed 2017 prices)\n\n## Question 1\n\nIn this question you'll prepare the dataset you'll use in this part.\n\na.  **Read:** Read the data and save it as an object called `gapminder_raw`.\n\nb.  **Filter:** For our analysis, we will only be working with data from 2023.\n    Filter the data set so only values from the year 2023 are included.\n    Save this data set as `gapminder_raw_23` and use it for the remainder of this exercise and the following.\n\nc.  **Glimpse:** Glimpse at `gapminder_raw_23` and list the variables and their types.\n    Comment on any unexpected features in the data.\n\nd.  **Clean:** First, figure out why `gdp_percap` is read in as a character variable and describe your findings in one sentence.\n    Then, clean the `gdp_percap` variable and convert it to numeric values.\n    Save the resulting data frame as `gapminder_23`.\n\n## Question 2\n\nWe are interested in learning more about life expectancy in countries, and we’ll start by exploring the relationship between life expectancy and GDP.\nCreate two visualizations:\n\n-   Scatter plot of `life_exp` vs. `gdp_percap` vs.\n\n-   Scatter plot of `life_exp_log` vs. `gdp_percap`, where `life_exp_log` is a new variable you add to the data set by taking the natural log of `life_exp`.\n\nFirst describe the relationship between each pair of the variables.\nThen, comment on which relationship would be better modeled using a linear model, and explain your reasoning.\n\n::: callout-note\nThe question isn't asking which of these relationships is clearly linear, but instead which would be better modeled using a linear model.\n:::\n\n## Question 3\n\na.  \\*\\* Data Prep \\*\\* What happens when you take the natural log of 0?\n    Remove rows of your data set where life_expectancy = 0, justifing why this is helpful.\n\nb.  **Model fitting:** Fit a linear model predicting log life expectancy from gross domestic product.\n    Display the tidy summary.\n\nc.  **Model evaluation:**\n\n    -   Calculate the R-squared of the model using two methods and confirm that the values match: first method is using `glance()` and the other method is based on the value of the correlation coefficient between the two variables.\n\n    -   Interpret R-squared in the context of the data and the research question.\n\n## Question 4\n\nNext, we want to examine if the relationship between life expectancy and GDP that we observed in the previous exercise holds across all continents in our data.\nWe’ll continue to work with logged life expectancy (`life_exp_log`) and data from 2023.\n\na.  **Justification:** Create a scatter plot of `life_exp_log` vs. `gdp_percap`, where the points are colored by `continent`.\n    Do you think the trend between `life_exp_log` and `gdp_percap` is different for different continents?\n    Justify your answer with specific features of the plot.\n\nb.  **Model fitting and interpretation:**\n\n    -   Regardless of your answer in part (a), fit an [additive model]{.underline} (main effects) that predicts `life_exp_log` from GDP per capita and continent (with Africas as the baseline level).\n        Display a tidy summary of the model output.\n\n    -   Interpret the *intercept* of the model, making sure that your interpretation is in the units of the original data (not on log scale).\n\n    -   Interpret the *slope* of the model, making sure that your interpretation is in the units of the original data (not on log scale).\n\nc.  **Prediction:** Predict the life expectacy of a country in Asia where the average GDP per capita is \\$70,000.\n    Do this using R functions, not by manually plugging in numbers.\n\n## Question 5\n\nCommunication is a critical yet often overlooked part of data science.\nWhen we engage with our audience and capture their interest, we can ultimately better communicate what we are trying to share.\n\nPlease watch the following video: [Hans Rosling: 200 years in 4 minutes](https://www.youtube.com/watch?v=Z8t4k0Q8e8Y).\n\nThen, write a paragraph (4-5 sentences) addressing the following:\n\n-   What did you enjoy about the presentation of data?\n    What did you find interesting\n\n-   Were there any aspects of the presentation that were hard to follow?\n    If so, what?\n\n-   What are your general take-aways from this presentation?\n\n-   What are your general take-aways from how this presentation was given?\n\n# Part 2 - Bike rentals\n\nBike sharing systems are new generation of traditional bike rentals where whole process from membership, rental and return back has become automatic.\nYou are tasked to investigate the relationship between the temperature outside and the number of bikes rented in the Washington DC area between the years 2011 and 2022.\nYou will be investigating data for the months June, July, September, and November.[^1]\n\n[^1]: Data subset from Progress in Artificial Intelligence, 2013.\n\nThe dataset is called `bike.csv` and it's in your lab repository's `data` folder.\n\nBelow is a list of variables and their definitions:\n\n+-------------+--------------------------------------------------------------------------------+\n| Variable    | Definition                                                                     |\n+:============+:===============================================================================+\n| `season`    | Numerical representation of Spring (2), Summer (3), and Fall (4)               |\n+-------------+--------------------------------------------------------------------------------+\n| `year`      | Numerical representation of 2011 (0) or 2012 (1)                               |\n+-------------+--------------------------------------------------------------------------------+\n| `month`     | Month in which data were collected                                             |\n+-------------+--------------------------------------------------------------------------------+\n| `holiday`   | Indicator variable for whether data were collected on a holiday (1) or not (0) |\n+-------------+--------------------------------------------------------------------------------+\n| `weekday`   | Numerical representation of day of week                                        |\n+-------------+--------------------------------------------------------------------------------+\n| `temp`      | Temperature in Celsius                                                         |\n+-------------+--------------------------------------------------------------------------------+\n| `count`     | Number of bike rentals for that day                                            |\n+-------------+--------------------------------------------------------------------------------+\n\n## Question 6\n\na.  Read in the data.\n    Then, create a scatter plot that investigates the relationship between the number of bikes rented and the temperature outside.\n    Include a straight line of best fit to help discuss the discovered relationship.\n    Summarize your findings in at most 4 sentences.\n\nb.  Another researcher suggests to look at the relationship between bikes rented and temperature by each of the four months of interest.\n    Recreate your plot in part a, and color the points by month.\n    Include a straight line for each of the four months to help discuss each month's relationship between bikes rented and temperature.\n    Summarize your findings in at most 4 sentences.\n\nWatch the following video on Simpson's Paradox [here](https://www.youtube.com/watch?v=ebEkn-BiW5k).\nAfter you do, please answer the following questions.\n\nc.  In your own words, summarize Simpson's Paradox in at most 4 sentences.\n\nd.  Compare and contrast your findings from part (a) and part (b).\n    What's different?\n\ne.  Think critically about your answer to part d.\n    What other context from this study could be creating this paradox?\n    That is, identify a potential confounding variable in this study.\n    Be sure to justify how your example could be a potential confounding variable by relating it back to both bike rentals and temperature.\n\n# Part 3 - Do you even lift?\n\nIn this part, you will be working with data from [www.openpowerlifting.org](https://www.openpowerlifting.org/).\nThis data was sourced from [Tidy Tuesday](https://github.com/rfordatascience/tidytuesday/tree/master/data/2019/2019-10-08) and contains international powerlifting records at various meets.\nAt each meet, each lifter gets three attempts at lifting max weight on three lifts: the bench press, squat and deadlift.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nipf <- read_csv(\"data/ipf.csv\")\n```\n:::\n\n\n\n\nThe data dictionary for this dataset from TidyTuesday is reproduced below:\n\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| variable           | description                                                                                                                                                                                                                                                                     |\n+:===================+:================================================================================================================================================================================================================================================================================+\n| `name`             | Individual lifter name                                                                                                                                                                                                                                                          |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `sex`              | Binary gender (M/F)                                                                                                                                                                                                                                                             |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `event`            | The type of competition that the lifter entered. Values are as follows:                                                                                                                                                                                                         |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   SBD: Squat-Bench-Deadlift, also commonly called \"Full Power\"                                                                                                                                                                                                                |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   BD: Bench-Deadlift, also commonly called \"Ironman\" or \"Push-Pull\"                                                                                                                                                                                                           |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   SD: Squat-Deadlift, very uncommon                                                                                                                                                                                                                                           |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   SB: Squat-Bench, very uncommon                                                                                                                                                                                                                                              |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   S: Squat-only                                                                                                                                                                                                                                                               |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   B: Bench-only                                                                                                                                                                                                                                                               |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   D: Deadlift-only                                                                                                                                                                                                                                                            |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `equipment`        | The equipment category under which the lifts were performed. Values are as follows:                                                                                                                                                                                             |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   Raw: Bare knees or knee sleeves                                                                                                                                                                                                                                             |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   Wraps: Knee wraps were allowed                                                                                                                                                                                                                                              |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   Single-ply: Equipped, single-ply suits                                                                                                                                                                                                                                      |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   Multi-ply: Equipped, multi-ply suits (includes Double-ply)                                                                                                                                                                                                                  |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   Straps: Allowed straps on the deadlift (used mostly for exhibitions, not real meets)                                                                                                                                                                                        |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `age`              | The age of the lifter on the start date of the meet, if known.                                                                                                                                                                                                                  |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `age_class`        | The age class in which the filter falls, for example `40-45`                                                                                                                                                                                                                    |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `division`         | Free-form UTF-8 text describing the division of competition, like `Open` or `Juniors 20-23` or `Professional`.                                                                                                                                                                  |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `bodyweight_kg`    | The recorded bodyweight of the lifter at the time of competition, to two decimal places.                                                                                                                                                                                        |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `weight_class_kg`  | The weight class in which the lifter competed, to two decimal places.                                                                                                                                                                                                           |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | Weight classes can be specified as a maximum or as a minimum. Maximums are specified by just the number, for example `90` means \"up to (and including) 90kg.\" minimums are specified by a `+` to the right of the number, for example `90+` means \"above (and excluding) 90kg.\" |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `best3squat_kg`    | Maximum of the first three successful attempts for the lift.                                                                                                                                                                                                                    |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | Rarely may be negative: that is used by some federations to report the lowest weight the lifter attempted and failed.                                                                                                                                                           |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `best3bench_kg`    | Maximum of the first three successful attempts for the lift.                                                                                                                                                                                                                    |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | Rarely may be negative: that is used by some federations to report the lowest weight the lifter attempted and failed.                                                                                                                                                           |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `best3deadlift_kg` | Maximum of the first three successful attempts for the lift.                                                                                                                                                                                                                    |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | Rarely may be negative: that is used by some federations to report the lowest weight the lifter attempted and failed.                                                                                                                                                           |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `place`            | The recorded place of the lifter in the given division at the end of the meet. Values are as follows:                                                                                                                                                                           |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   Positive number: the place the lifter came in.                                                                                                                                                                                                                              |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   G: Guest lifter. The lifter succeeded, but wasn't eligible for awards.                                                                                                                                                                                                      |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   DQ: Disqualified. Note that DQ could be for procedural reasons, not just failed attempts.                                                                                                                                                                                   |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   DD: Doping Disqualification. The lifter failed a drug test.                                                                                                                                                                                                                 |\n|                    |                                                                                                                                                                                                                                                                                 |\n|                    | -   NS: No-Show. The lifter did not show up on the meet day.                                                                                                                                                                                                                    |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `date`             | ISO 8601 Date of the event                                                                                                                                                                                                                                                      |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `federation`       | The federation that hosted the meet. (limited to IPF for this data subset)                                                                                                                                                                                                      |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n| `meet_name`        | The name of the meet. The name is defined to never include the year or the federation. For example, the meet officially called `2019 USAPL Raw National Championships` would have the MeetName `Raw National Championshps`.                                                     |\n+--------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\nFor all of the following exercises, you should include units on axes labels, e.g. \"Bench press (lbs)\" or \"Bench press (kg)\".\n\"Age (years)\" etc.\nThis is good practice.\n\n## Question 7\n\na\\.\nLet's begin by taking a look at the **squat lifting** records.\n\n-   Start with the `ipf` data frame.\n-   First, remove any observations that are negative for squat.\n-   Next, create a new column called `best3_squat_lbs` that converts the record from kilograms to pounds.\n\nYou may need to google the conversion formula.\nSave your data frame as `ipf_squat`.\nReport the number of rows and columns of this new data frame using inline code.\n\nb\\.\nUsing the `ipf_squat` data frame you created in part (a), create a scatter plot to investigate the relationship between squat (in lbs) and age.\nAge should be on the x-axis.\nAdjust the `alpha` level of your points to get a better sense of the density of the data.\nAdd a linear trend-line.\nSummarize the trend you observe in at most 4 sentences.\n\nc\\.\nWrite down the linear population model to predict lift squat lbs from age.\nNext, fit the linear model, and save it as `age_fit`.\nRe-write your previous equation replacing the population parameters with the numeric estimates.\nThis is called the \"fitted\" linear model.\nInterpret each estimate of $\\beta$.\nAre the interpretations sensible?\n\n## Question 8\n\na\\.\nBuilding on your `ipf_squat` data frame from the previous question, create a new column called `age2` that takes the age of each lifter and squares it.\nSave it to your data frame `ipf_squat`.\nNext, plot squat in lbs vs `age2` and add a linear best fit line.\nHow does the fit of the model compare to the one from earlier?\n\n::: callout-tip\nTo raise a value to a power, use `^` in R, e.g.: `2 ^ 2` gives you 4, `2 ^ 3` gives you 8, etc.\n:::\n\nb\\.\nOne metric to assess the fit of a model is the correlation squared, also known as $R^2$.\nFit the age$^2$ model and save the object as `age2_fit`.\nCompare $R^2$ of the new model (squat vs. age$^2$) to the $R^2$ of the earlier model (squat vs. age).\nWhich has a higher $R^2$?\n\n## Question 9\n\nStart over with the `ipf` data frame.\n\nNext, let's turn our attention to **dead lifting** records.\nRecreate the plot below.\nMake sure axes and title labels are exactly matching, including spelling, capitalization, etc.\nBased on the plot below, which impacts deadlift weight more, age category or sex?\n\n![](images/lab-6/deadlift-age-sex-plot.png){fig-align=\"center\" width=\"400\"}\n\n::: callout-note\nYou will need to create a couple of new columns.\nOne to classify age appropriately and one to convert `best3deadlift_kg` to the plotted units (lbs).\nNotice that there are no negative deadlift values on the x-axis.\n:::\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n\n## Question 10\n\na\\.\nStart over with the `ipf` data frame.\n\nFinally, let's turn our attention to **bench press** records.\n\nTo begin, remove any observations that are negative for bench press, create two new columns: `best3bench_lbs` and `bodyweight_lbs`.\nSave the result in a new data frame called `ipf_bench`.\n\nThen, create a scatter plot to investigate the relationship between best bench press (in lbs) and the lifter's bodyweight (in lbs).\nBodyweight should be on the x-axis.\nAdd a linear trend-line.\nBe sure to label all axes and give the plot a title.\nComment on what you observe.\n\nb\\.\nFit the linear model displayed in part (a) and write down the **fitted model equation** only, replacing $\\hat{\\beta}$s with their fitted estimates.\nInterpret the $\\hat{\\beta}$s (intercept and slope).\nReport $R^2$.\nIs body weight an important predictor of bench press ability?\nWhy or why not?\n",
    "supporting": [
      "lab-6_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}