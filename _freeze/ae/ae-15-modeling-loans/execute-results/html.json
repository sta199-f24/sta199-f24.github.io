{
  "hash": "881be0638a20db63c4706538799f6e2d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"AE 15: Modelling loan interest rates\"\n---\n\n\n\n\n\n\n\n\n\nIn this application exercise we will be studying loan interest rates.\nThe dataset is one you've come across before in your reading -- the dataset about loans from the peer-to-peer lender, Lending Club, from the **openintro** package.\nWe will use **tidyverse** and **tidymodels** for data exploration and modeling, respectively.\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(openintro)\n```\n:::\n\n\n\n\n\n\n\n\n\nBefore we use the dataset, we'll make a few transformations to it.\n\n-   **Your turn:** Review the code below with your neighbor and write a summary of the data transformation pipeline.\n\n*Add response here.*\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloans <- loans_full_schema |>\n  mutate(\n    credit_util = total_credit_utilized / total_credit_limit,\n    bankruptcy = as.factor(if_else(public_record_bankrupt == 0, 0, 1)),\n    verified_income = droplevels(verified_income),\n    homeownership = str_to_title(homeownership),\n    homeownership = fct_relevel(homeownership, \"Rent\", \"Mortgage\", \"Own\")\n  ) |>\n  rename(credit_checks = inquiries_last_12m) |>\n  select(\n    interest_rate, loan_amount, verified_income, \n    debt_to_income, credit_util, bankruptcy, term, \n    credit_checks, issue_month, homeownership\n  )\n```\n:::\n\n\n\n\n\n\n\n\n\nHere is a glimpse at the data:\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(loans)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 10,000\nColumns: 10\n$ interest_rate   <dbl> 14.07, 12.61, 17.09, 6.72, 14.07, 6.72, 13.59, 11.99, …\n$ loan_amount     <int> 28000, 5000, 2000, 21600, 23000, 5000, 24000, 20000, 2…\n$ verified_income <fct> Verified, Not Verified, Source Verified, Not Verified,…\n$ debt_to_income  <dbl> 18.01, 5.04, 21.15, 10.16, 57.96, 6.46, 23.66, 16.19, …\n$ credit_util     <dbl> 0.54759517, 0.15003472, 0.66134832, 0.19673228, 0.7549…\n$ bankruptcy      <fct> 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, …\n$ term            <dbl> 60, 36, 36, 36, 36, 36, 60, 60, 36, 36, 60, 60, 36, 60…\n$ credit_checks   <int> 6, 1, 4, 0, 7, 6, 1, 1, 3, 0, 4, 4, 8, 6, 0, 0, 4, 6, …\n$ issue_month     <fct> Mar-2018, Feb-2018, Feb-2018, Jan-2018, Mar-2018, Jan-…\n$ homeownership   <fct> Mortgage, Rent, Rent, Rent, Rent, Own, Mortgage, Mortg…\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n# Get to know the data\n\n-   **Your turn:** What is a typical interest rate in this dataset? What are some attributes of a typical loan and a typical borrower. Give yourself no more than 5 minutes for this exploration and share 1-2 findings.\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code to explore loans here\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code to explore borrowers here\n```\n:::\n\n\n\n\n\n\n\n\n\n# Interest rate vs. credit utilization ratio\n\nThe regression model for interest rate vs. credit utilization is as follows.\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrate_util_fit <- linear_reg() |>\n  fit(interest_rate ~ credit_util, data = loans)\n\ntidy(rate_util_fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 5\n  term        estimate std.error statistic   p.value\n  <chr>          <dbl>     <dbl>     <dbl>     <dbl>\n1 (Intercept)    10.5     0.0871     121.  0        \n2 credit_util     4.73    0.180       26.3 1.18e-147\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\nAnd here is the model visualized:\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(loans, aes(x = credit_util, y = interest_rate)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\")\n```\n\n::: {.cell-output-display}\n![](ae-15-modeling-loans_files/figure-html/rate-util-plot-1.png){width=672}\n:::\n:::\n\n\n\n\n\n\n\n\n\n-   **Your turn:** Interpret the intercept and the slope.\n\n*Add response here.*\n\n# Interest rate vs. homeownership\n\nNext we predict interest rates from homeownership, which is a categorical predictor with three levels:\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlevels(loans$homeownership)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Rent\"     \"Mortgage\" \"Own\"     \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n-   **Demo:** Fit the linear regression model to predict interest rate from homeownership and display a tidy summary of the model. Write the estimated model output below.\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here.\n```\n:::\n\n\n\n\n\n\n\n\n\n-   **Your turn:** Interpret each coefficient in context of the problem.\n\n*Add response here.*\n\n# Interest rate vs. credit utilization and homeownership\n\n## Main effects model\n\n-   **Demo:** Fit a model to predict interest rate from credit utilization and homeownership, **without** an interaction effect between the two predictors. Display the summary output and write out the estimated regression equation.\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n\n\n\n\n\n\n\n*Add response here.*\n\n-   **Demo:** Write the estimated regression equation for loan applications from each of the homeownership groups separately.\n    -   Rent: *Add response here.*\n    -   Mortgage: Add response here.\n    -   Own: Add response here.\n-   **Question:** How does the model predict the interest rate to vary as credit utilization varies for loan applicants with different homeownership status. Are the rates the same or different?\n\n*Add response here.*\n\n## Interaction effects model\n\n-   **Demo:** Fit a model to predict interest rate from credit utilization and homeownership, **with** an interaction effect between the two predictors. Display the summary output and write out the estimated regression equation.\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n\n\n\n\n\n\n\n*Add response here.*\n\n-   **Demo:** Write the estimated regression equation for loan applications from each of the homeownership groups separately.\n    -   Rent: *Add response here.*\n    -   Mortgage: Add response here.\n    -   Own: Add response here.\n-   **Question:** How does the model predict the interest rate to vary as credit utilization varies for loan applicants with different homeownership status. Are the rates the same or different?\n\n*Add response here.*\n\n## Choosing a model\n\nRule of thumb: **Occam's Razor** - Don't overcomplicate the situation!\nWe prefer the *simplest* best model.\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n\n\n\n\n\n\n\n-   **Review:** What is R-squared? What is adjusted R-squared?\n\n*Add response here.*\n\n-   **Question:** Based on the adjusted $R^2$s of these two models, which one do we prefer?\n\n*Add response here.*\n\n# Another model to consider\n\n-   **Your turn:** Let's add one more model to the variable -- issue month. Should we add this variable to the interaction effects model from earlier?\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# add code here\n```\n:::\n\n\n\n\n\n\n\n\n\n*Add response here.*\n",
    "supporting": [
      "ae-15-modeling-loans_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}