{
  "hash": "3240a9ab35929babf33bf162abace528",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"AE 11: UN Votes - Revisit + Chat GPT adventures\"\n---\n\n\n\n# Part 1: UN Votes - Revisit\n\nYou've seen this analysis before.\nIt's time to revisit it and clean it up for code smell, style, and readability.\nMake the necessary updates to the code to improve the code.\nThen, review the diff before you render, commit (with an appropriate message), and push.\n\n------------------------------------------------------------------------\n\n## Introduction\n\nHow do various countries vote in the United Nations General Assembly, how have their voting patterns evolved throughout time, and how similarly or differently do they view certain issues?\nAnswering these questions (at a high level) is the focus of this analysis.\n\n### Packages\n\nWe will use the **tidyverse**, **lubridate**, and **scales** packages for data wrangling and visualization, and the **DT** package for interactive display of tabular output, and the **unvotes** package for the data.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(scales)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'scales'\n\nThe following object is masked from 'package:purrr':\n\n    discard\n\nThe following object is masked from 'package:readr':\n\n    col_factor\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(unvotes)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nIf you use data from the unvotes package, please cite the following:\n\nErik Voeten \"Data and Analyses of Voting in the UN General Assembly\" Routledge Handbook of International Organization, edited by Bob Reinalda (published May 27, 2013)\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggthemes)\n```\n:::\n\n\n\n### Data\n\nThe data we're using originally come from the **unvotes** package.\nIn the chunk below we modify the data by joining the various data frames provided in the package to help you get started with the analysis.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunvotes <- un_votes |>inner_join(un_roll_calls, by = join_by(rcid)) |>\n  inner_join(un_roll_call_issues, \nby = join_by(rcid == rcid),relationship = \"many-to-many\")\n\nprint(unvotes)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 857,878 × 14\n    rcid country country_code vote  session importantvote date       unres amend\n   <dbl> <chr>   <chr>        <fct>   <dbl>         <int> <date>     <chr> <int>\n 1     6 United… US           no          1             0 1946-01-04 R/1/…     0\n 2     6 Canada  CA           no          1             0 1946-01-04 R/1/…     0\n 3     6 Cuba    CU           yes         1             0 1946-01-04 R/1/…     0\n 4     6 Domini… DO           abst…       1             0 1946-01-04 R/1/…     0\n 5     6 Mexico  MX           yes         1             0 1946-01-04 R/1/…     0\n 6     6 Guatem… GT           no          1             0 1946-01-04 R/1/…     0\n 7     6 Hondur… HN           yes         1             0 1946-01-04 R/1/…     0\n 8     6 El Sal… SV           abst…       1             0 1946-01-04 R/1/…     0\n 9     6 Nicara… NI           yes         1             0 1946-01-04 R/1/…     0\n10     6 Panama  PA           abst…       1             0 1946-01-04 R/1/…     0\n# ℹ 857,868 more rows\n# ℹ 5 more variables: para <int>, short <chr>, descr <chr>, short_name <chr>,\n#   issue <fct>\n```\n\n\n:::\n:::\n\n\n\n## UN voting patterns\n\nLet's create a data visualization that displays how the voting record of the United States, United Kingdom, and Turkey changed over time.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nunvotes |>\n  filter(country%in%c(\"United Kingdom\", \"United States\", \"Turkey\")) |>\n    mutate(year = year(date))|>\n      group_by(country, year, issue) |>\n    summarize(percent_yes = mean(vote==\"yes\"),.groups = \"drop\") |>\n\n  \nggplot(aes(x = year, \n           y = percent_yes, \n           color = country)) +\n  geom_smooth(method = \"loess\", se = FALSE) + facet_wrap(~issue) +\n              scale_color_colorblind() +\n  labs(\n    title = \"Percentage of 'Yes' votes in the UN General Assembly\",\nsubtitle = \"1946 to 2019\",y = \"% Yes\",x = \"Year\",color = \"Country\"\n  )+\n   geom_point(alpha = 0.4)+scale_y_continuous(labels = percent)\n```\n\n::: {.cell-output-display}\n![](ae-11-unvotes-revisit-chatgpt_files/figure-html/plot yearly yes issue-1.png){width=960}\n:::\n:::\n\n\n\n## References\n\n1.  Robinson D (2021). *unvotes: United Nations General Assembly Voting Data*. R package version 0.3.0, <https://github.com/dgrtwo/unvotes>.\n2.  Erik Voeten \"Data and Analyses of Voting in the UN General Assembly\" Routledge Handbook of International Organization, edited by Bob Reinalda (published May 27, 2013).\n3.  Much of the analysis has been modeled on the examples presented in the [unvotes package vignette](https://cran.r-project.org/web/packages/unvotes/vignettes/unvotes.html).\n\n# Part 2: ChatGPT adventures\n\nSuppose you gave the following prompt THAT YOU SHOULDN'T HAVE IN THE FIRST PLACE to Chat GPT and it gave you the response provided below.\nImprove the code for correctness, code smell, style, and readability.\n\n------------------------------------------------------------------------\n\n> SurveyUSA polled 900 NC adults between September 4-7, 2024.\n> Of the 900 NC adults, 771 were identified by SurveyUSA as being registered to vote.\n> The following question was asked to these 771 adults: \"Should the use of marijuana for medical use remain against the law in North Carolina? Or be legalized?\"\n>\n> Of the 771 responses, 391 were between the ages of 18-49.\n> Of the individuals that are between 18-49, 59 individuals responded that they think medical marijuana should remain against the law, 292 said it should be made legal, and the remainder were not sure.\n> Of the individuals that are 50+, 67 individuals responded that they think medical marijuana should remain against the law, 245 said it should be made legal, and the remainder were not sure.\n>\n> Calculate the proportions of 18-49 year olds and 50+ year-olds in this sample.\n> Make sure the result is an ungrouped data frame with a column for relevant counts, a column for relevant proportions, and a column for the groups you’re interested in.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\n\n# Create the initial data frame with counts\nsurvey_counts <- tibble( \n  age = c(\"18-49\", \"18-49\", \"18-49\", \"50+\", \"50+\", \"50+\"),\n  opinion = c(\"Against\", \"Legal\", \"Not sure\", \"Against\", \"Legal\", \"Not sure\"),\n  n = c(59, 292, 40, 67, 245, 59)\n)\n\n# Group by age and summarize total counts\nage_totals <- survey_counts %>%\n  group_by(age) %>%\n  summarize(total_count = sum(n)) %>%\n  ungroup()\n\n# Calculate the overall total\noverall_total <- sum(age_totals$total_count)\n\n# Add the proportion column\nage_totals <- age_totals %>%\n  mutate(proportion = total_count / overall_total)\n\n# Resulting data frame\nprint(age_totals)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 3\n  age   total_count proportion\n  <chr>       <dbl>      <dbl>\n1 18-49         391      0.513\n2 50+           371      0.487\n```\n\n\n:::\n:::\n",
    "supporting": [
      "ae-11-unvotes-revisit-chatgpt_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}